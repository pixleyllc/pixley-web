<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixley ‚Äì Profile</title>
<link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>

<div class="pixley-wordmark">P I X L E Y</div>

<div class="page">
  <div class="inner">
    <div class="profile-header" id="profileHeader">
      <!-- Profile info dynamically injected here -->
    </div>

    <div id="profilePosts">
      <!-- User's posts will render here -->
    </div>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

<!-- Pixley App JS -->
<script src="../assets/js/app.js"></script>

<script>
// Require login
firebase.auth().onAuthStateChanged(async user => {
  if (!user) {
    window.location.href = '/auth/login.html';
    return;
  }

  const profileHeader = document.getElementById('profileHeader');
  const profilePosts = document.getElementById('profilePosts');

  // Get user info
  const userDoc = await firebase.firestore().collection('users').doc(user.uid).get();
  const userData = userDoc.data();

  // Build profile header
  profileHeader.innerHTML = `
    <img class="avatar" src="${userData.photoURL}" alt="${userData.displayName}">
    <div class="profile-main">
      <div class="handle-row">
        <div class="username">@${userData.username}</div>
        ${userData.verified ? '<span class="verified-badge">VERIFIED</span>' : ''}
      </div>
      <div class="bio">${userData.bio || ''}</div>
      <div class="stats">
        <div><strong>${userData.postsCount || 0}</strong> Posts</div>
        <div><strong>${userData.followersCount || 0}</strong> Followers</div>
        <div><strong>${userData.followingCount || 0}</strong> Following</div>
      </div>
      <div class="actions">
        <button class="btn primary" onclick="window.location.href='/profile/edit.html'">Edit Profile</button>
      </div>
    </div>
  `;

  // Load user posts
  const postsSnapshot = await firebase.firestore().collection('posts')
    .where('userId', '==', user.uid)
    .orderBy('createdAt', 'desc')
    .get();

  profilePosts.innerHTML = '';
  postsSnapshot.forEach(doc => {
    const post = doc.data();
    const postCard = document.createElement('div');
    postCard.className = 'post';
    postCard.innerHTML = `
      <div class="post-head">
        <div class="post-user">
          <img src="${userData.photoURL}" alt="${userData.username}">
          <div>@${userData.username}</div>
        </div>
        <div class="post-time">${new Date(post.createdAt.seconds*1000).toLocaleString()}</div>
      </div>
      <div class="post-caption">${post.caption}</div>
      ${post.mediaURL ? `<div class="post-media"><img src="${post.mediaURL}" alt="post media"></div>` : ''}
      <div class="post-actions">‚ù§Ô∏è üîÅ üí¨</div>
    `;
    profilePosts.appendChild(postCard);
  });
});
</script>

</body>
</html>
